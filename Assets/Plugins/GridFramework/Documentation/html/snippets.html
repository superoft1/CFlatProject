<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>Grid Framework: Frequently used snippets</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js.txt"></script>
<script type="text/javascript" src="dynsections.js.txt"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js.txt"></script>
<script type="text/javascript" src="navtreedata.js.txt"></script>
<script type="text/javascript" src="navtree.js.txt"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js.txt"></script>
<script type="text/javascript" src="search/search.js.txt"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_html_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grid Framework
   &#160;<span id="projectnumber">2.1.6</span>
   </div>
   <div id="projectbrief">Easy grid setup and scripting for Unity 3D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js.txt"></script>
<script type="text/javascript" src="menu.js.txt"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('snippets.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Frequently used snippets </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Over the years I have been getting similar questions and requests. Not all features requests are suitable to be implemented, they might be too problem-specific or they might not be applicable to all kinds of grids. In this chapter I will collect a number of frequently used snippets.</p>
<p>Unlike the examples these snippets are meant to be copy-pasted and slightly altered according to your needs.</p>
<h2>Limiting an object's position to the grid </h2>
<p>Grids are infinitely large, so we have to manually limit our objects to the visible range. First we will need a way to clamp a vector between a lower and upper limit:</p>
<div class="fragment"><div class="line">Vector3 ClampVector3(Vector3 v, Vector3 lower, Vector3 upper) {</div><div class="line">    <span class="keywordflow">return</span> Vector3.Max(lower, Vector3.Min(upper, v));</div><div class="line">}</div></div><!-- fragment --><p>Here is a snippet for rectangular grids:</p>
<div class="fragment"><div class="line"><span class="comment">// Parallelepiped is the renderer of the grid</span></div><div class="line"><span class="keywordtype">void</span> ClampTransform(Transform obj, <a class="code" href="namespace_rect_grid.html">RectGrid</a> grid, <a class="code" href="namespace_parallelepiped.html">Parallelepiped</a> para) {</div><div class="line">    var spacing = grid.spacing;</div><div class="line"></div><div class="line">    <span class="comment">// The limits in world coordinates</span></div><div class="line">    var from = para.From;</div><div class="line">    var to   = para.To;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// We must also take into account the size of the object itself</span></div><div class="line">    <span class="keywordflow">for</span> (var i = 0; i &lt; 3; ++i) {</div><div class="line">        from[i] += obj.lossyScale[i] / 2.0f * spacing[i];</div><div class="line">          to[i] -= obj.lossyScale[i] / 2.0f * spacing[i];</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Now convert the result to world-coordinates</span></div><div class="line">    from = grid.GridToWorld(from);</div><div class="line">    to   = grid.GridToWorld(to  );</div><div class="line"></div><div class="line">    <span class="comment">// Clamp the object</span></div><div class="line">    ClampVector3(obj.position, from, to);</div><div class="line">}</div></div><!-- fragment --><p>For non-rectangular grids the shape of an object's bounding box (a cuboid) does not match the shape of the grid, so you have to decide for your game specifically how to handle objects at the edge of the grid.</p>
<h2>Clicking a tile of the grid </h2>
<p>There are many ways of getting input in Unity. My personal choice is raycasting: a <code>Collider</code> is placed to line up with the grid and a ray is cast through the cursor. Where the ray hits the <code>Collider</code> we convert the position to grid-coordinates.</p>
<p>First attach a <code>Collider</code> component to your grid. Any <code>Collider</code> works, but I use either a <code>PlaneCollider</code> or a generated <code>MeshCollider</code>. Make sure the plane or mesh is oriented properly, otherwise your ray will just pass through.</p>
<p>We will then cast a <code>Ray</code> that can <em>only</em> collide with this <code>Collider</code>. You can set the layer of the <code>Collider</code> to something other objects in the game can't collide with if you want to.</p>
<div class="fragment"><div class="line">Vector3 ClickGrid(<a class="code" href="namespace_rect_grid.html">RectGrid</a> grid, Collider coll) {</div><div class="line">    RaycastHit hit;   <span class="comment">// Store raycast results here</span></div><div class="line">    Vector3    tile;  <span class="comment">// Tile that has been clicked</span></div><div class="line"></div><div class="line">    <span class="comment">// Ray from cursor position and camera angle</span></div><div class="line">    Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);</div><div class="line"></div><div class="line">    <span class="comment">// Perform the raycast</span></div><div class="line">    <span class="keywordflow">if</span> (coll.Raycast(ray, hit, 100.0)) {</div><div class="line">        tile = hit.point;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Convert to grid coordinates</span></div><div class="line">    <span class="keywordflow">return</span> grid.WorldToGrid(tile);</div><div class="line">}</div></div><!-- fragment --><h2>Pathfinding using Aaron Granberg's <em>A-star Pathfinding</em> </h2>
<p>This popular <a href="http://arongranberg.com/astar/">pathfinding plugin</a> has five types of pathfinding graphs: grid, mesh, point, recast and layered. Out of these only the grid-graph can be built from data rather than geometry and it is limited to a two-dimensional rectangle, i.e. no shearing.</p>
<p>The following snippet will generate an <em>XZ</em>-grid graph from a <code>RectGrid</code> instance. Make sure you have an <em>AStar Pathfinding</em> object in your scene.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> AstarData AstarDataFromRectGrid(<a class="code" href="namespace_rect_grid.html">RectGrid</a> grid,</div><div class="line">                                              <a class="code" href="namespace_parallelepiped.html">Parallelepiped</a> para) {</div><div class="line">    var data = AstarPath.active.astarData;</div><div class="line">    var gg = data.AddGraph(typeof(GridGraph)) as GridGraph;</div><div class="line"></div><div class="line">    var width = Mathf.RoundToInt(para.To.x - para.From.x);</div><div class="line">    var depth = Mathf.RoundToInt(para.To.z - para.From.z);</div><div class="line">    var spacing = grid.spacing;</div><div class="line"></div><div class="line">    gg.width       = width;</div><div class="line">    gg.depth       = depth;</div><div class="line">    gg.nodeSize    = 1;</div><div class="line">    gg.aspectRatio = spacing.x / spacing.z;</div><div class="line">    gg.center      = grid.GridToWorld(Vector3.zero);</div><div class="line"></div><div class="line">    gg.UpdateSizeFromWidthDepth();</div><div class="line">    AstarPath.active.Scan();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> data;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Sep 10 2017 00:05:37 for Grid Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png.txt" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
